<!DOCTYPE html>
<html lang="en" class="has-background-info" style="min-height: auto;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <script src="https://unpkg.com/vue"></script>
</head>
<style>
html, body{
    height: 100%;
    overflow: hidden;
}
.scroll-container {
    height: 100%;
    width: 100%;
    overflow: hidden;
}
.hover-list:hover {
    background-color: #e6e6e6;
}
.strikethrough {
    text-decoration: line-through;
}
.scrollmenu {
    padding: 10px 10px 10px 10px;
    white-space: nowrap;
    width: 100%;
    height: 100%;
    overflow: auto;
    padding-right: 15px;
}

.scrollmenu div {
    width: 300px;
    display: inline-block;
}

.scrollmenu div div {
    height: auto;
    position: relative;
}

.scrollmenu a:hover {
  background-color: #777;
}
.list-container {
    padding: 14px;
    background: white;
    border-radius: 5px;
    height: 300px;
}
.list-section {
    height: 100%;
}
.card-shadow {
    -webkit-box-shadow: 0px 4px 9px -5px rgba(0,0,0,0.15);
    -moz-box-shadow: 0px 4px 9px -5px rgba(0,0,0,0.15);
    box-shadow: 0px 4px 9px -5px rgba(0,0,0,0.15);
}
</style>
<body>
    <div id="app" class="scroll-container">
        <div v-if="show === true" class="has-background-info" style="width: 100vw;height: 100vh;position: relative">
            <div class="container" style="min-height: 100vh"> 
                <div class="tile is-parent" style="margin: auto 0px;height: 80vh;height: 100%;">
                    <article class="tile is-child notification">
                        <div style="position:sticky;top:0px;z-index: 2;padding: 0px 1 0px;border-bottom: 2px solid lightgrey" class="notification">
                            <div class="columns is-marginless">
                                <div class="column">
                                    <div class="title">{{curTodoArray.name}}</div>
                                </div>
                                <div class="column is-3 is-pulled-right">
                                    <a class="is-pulled-right has-text-weight-semibold" @click="show = false" style="text-decoration: none;">
                                        <span>Close</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <a style="text-decoration: none;">
                            <div v-for="(data, index) in curTodoArray.toDo" style="position: relative">
                                <div @click="data.isDone = !data.isDone" class="tile is-child notification columns hover-list" style="border-left: 2px solid darkgrey; margin: 4px 0px;">
                                    <div class="column is-10">
                                        <div class="title is-5 has-text-grey" :class="{strikethrough: data.isDone}">
                                            {{data.text}}
                                        </div>
                                    </div>
                                </div>
                                <div class="column is-pulled-right hover-list" style="position: absolute;top:20%;right: 20px;border-radius: 50%" @click="remove(index)">
                                    <span class="icon is-pulled-right">
                                        <i class="fas fa-times"></i>
                                    </span>
                                </div>
                            </div>
                        </a>

                        <div class="columns is-marginless is-paddingless">
                            <div class="column is-11 field" style="margin:0px">
                                <div class="control">
                                    <input v-model="curTextToDoInput" type="text" class="input" placeholder="Add your To Do" @keyup.enter="addTodo" />
                                </div>
                            </div>
                            <div class="column is-1">
                                <input type="button" class="button is-light is-pulled-right has-text-weight-semibold" value="Add" style="width: 100%" @click="addTodo"/>  
                            </div>
                        </div>
                    </article>
                </div>
            </div>
        </div>
        <div class="columns" style="margin:10px">
            <input v-model="curTextListInput" type="text" class="column is-2 input" placeholder="List Name" style="margin-right: 10px" @keyup.enter="addList">
            <input type="button" class="button has-text-weight-semibold" value="Add List" @click="addList()" />
        </div>
        <div v-if="board.lists.length > 0" class="scrollmenu">
            <div class="list-section">
                <div v-for="(list, listIndex) in board.lists" class="list-container has-background-light" style="margin-right:5px;width: 100%;" @dragover="allowDrop" @drop="drop($event, listIndex)">
                    <div class="content" style="width:100%; padding: 0px;margin: 0px">
                        <div class="title is-5" style="width: 100%; margin-bottom: 5px;overflow: hidden;">
                            {{list.name}}
                        </div>
                    </div>
                    <hr style="margin: 10px 0;border: 1px solid #ebebeb"/>

                    <!-- card -->
                    <div v-for="(card, cardIndex) in list.cards" class="card-shadow is-pulled-left" style="margin: 3px 0px; width: 100%" style="width: 100%" draggable="true" @dragstart="drag($event, card, listIndex, cardIndex)">
                        <a class="button is-white" style="width: 100%;border: 1px solid #ebebeb;justify-content: left;text-align: left" @click="showTodo(cardIndex, card)">
                            <div style="justify-content: left">
                                {{card.name}}
                            </div>
                        </a>
                    </div>
                    <!-- /card -->
                    <div class="is-pulled-left visible-on-hover" style="margin-top: 20px">
                        <div class="columns" style="width: 100%;padding: 5px">
                            <input v-model="list.curTextCardInput" class="input is-light column" type="input" placeholder="Card Name" style="margin-right: 5px" @keyup.enter="list.curTextCardInput != '' ? list.cards.push({name: list.curTextCardInput, toDo: []}) : null; list.curTextCardInput = ''">
                            <input class="button is-light has-text-weight-semibold" type="button" value="Add Card" @click="list.curTextCardInput != '' ? list.cards.push({name: list.curTextCardInput, toDo: []}) : null; list.curTextCardInput = ''">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>

const app = new Vue({
    el: '#app',
    data: {
        show: false,
        curTextListInput: '',
        curTextToDoInput: '',
        curTodoArray: [],
        board: {
            name: 'Project',
            lists: []
        }
    },
    methods: {
        addList: function() {
            if(this.curTextListInput === '') {
                return
            }
            this.board.lists.push({
                name: this.curTextListInput,
                curTextCardInput: '',
                cards: []
            })
        },
        showTodo: function(index, val) {
            this.show = !this.show
            this.curTodoArray = val
        },
        drag: function(e, data, listIndex, cardIndex) {
            var dataTemplate = {
                from: {
                    index: listIndex,
                    card: {
                        index: cardIndex
                    }
                },
                payload: {
                    name: data.name,
                    toDo: data.toDo
                }
            }
            var dataStringify = JSON.stringify(dataTemplate)

            e.dataTransfer.setData("text", dataStringify)
        },
        allowDrop: function(e) {
            e.preventDefault()
        },
        drop: function(e, to) {
            var data = e.dataTransfer.getData("text")
            var dataParse = JSON.parse(data)
            var listIndex = dataParse.from.index
            var cardIndex = dataParse.from.card.index

            for(var i = cardIndex; i < this.board.lists[listIndex].cards.length; i++) {
                this.board.lists[listIndex].cards[i] = this.board.lists[listIndex].cards[i+1]
            }
            this.board.lists[listIndex].cards.pop()
            this.board.lists[to].cards.push(dataParse.payload)
        },
        remove: function(index) {
            for(var i = index; i < this.curTodoArray.toDo.length; i++) {
                this.curTodoArray.toDo[i] = this.curTodoArray.toDo[i+1]
            }
            this.curTodoArray.toDo.pop()
        },
        addTodo: function() {
            this.curTodoArray.toDo.push({text: this.curTextToDoInput, isDone: false})
            this.curTextToDoInput = ''
        }
    }
})
</script>
</html>